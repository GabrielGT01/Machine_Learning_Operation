
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Batch Trip Duration — CSV Upload</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#0f172a;            /* slate-900 */
      --card:#111827;          /* gray-900 */
      --muted:#9ca3af;         /* gray-400 */
      --text:#e5e7eb;          /* gray-200 */
      --primary:#4f46e5;       /* indigo-600 */
      --primary-2:#6366f1;     /* indigo-500 */
      --accent:#22d3ee;        /* cyan-400 */
      --ok:#16a34a;            /* green-600 */
      --warn:#f59e0b;          /* amber-500 */
      --err:#ef4444;           /* red-500 */
      --shadow: 0 20px 60px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.02);
      --radius: 16px;
    }
    *{box-sizing:border-box}
    body{
      margin:0; padding:32px;
      background:
        radial-gradient(1200px 600px at 10% -10%, rgba(79,70,229,.20), transparent 60%),
        radial-gradient(900px 500px at 100% 0, rgba(34,211,238,.14), transparent 60%),
        var(--bg);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color:var(--text);
      line-height:1.5;
    }
    .container{
      max-width: 880px; margin: 0 auto;
      background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01));
      border:1px solid rgba(255,255,255,.06);
      border-radius: var(--radius);
      padding: 28px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(6px);
    }
    header{
      display:flex; align-items:flex-start; gap:16px; margin-bottom: 18px;
    }
    .logo{
      width:44px;height:44px;border-radius:12px;
      background: radial-gradient(120% 120% at 30% 30%, var(--accent), var(--primary));
      box-shadow: 0 10px 30px rgba(99,102,241,.35), inset 0 0 10px rgba(255,255,255,.25);
    }
    h1{ margin:0; font-size: clamp(1.25rem, 1rem + 1.2vw, 1.9rem); letter-spacing:.2px;}
    .subtitle{ margin: 6px 0 0; color:var(--muted); font-size:.98rem}
    .grid{ display:grid; grid-template-columns: 1.4fr .9fr; gap:24px; }
    @media (max-width: 880px){ .grid{ grid-template-columns: 1fr; } }

    .card{
      background: rgba(2,6,23,.4);
      border:1px solid rgba(255,255,255,.06);
      border-radius: 14px; padding: 18px;
    }
    .label{ font-weight:600; margin-bottom:8px; display:block; }

    /* Dropzone */
    .drop{
      border: 2px dashed rgba(99,102,241,.45);
      border-radius: 14px;
      padding: 28px;
      display:flex; flex-direction:column; align-items:center; justify-content:center;
      gap:10px; text-align:center;
      transition:.2s ease;
      background: rgba(99,102,241,.06);
    }
    .drop.dragover{
      border-color: var(--accent);
      background: rgba(34,211,238,.10);
      transform: translateY(-1px);
      box-shadow: 0 8px 30px rgba(34,211,238,.15);
    }
    .hint{ color:var(--muted); font-size:.96rem }
    .code{ font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
           background: rgba(2,6,23,.7); border:1px solid rgba(255,255,255,.06);
           padding:6px 8px; border-radius:8px; }

    .controls{ display:flex; gap:12px; align-items:center; justify-content:flex-end; margin-top: 14px; }
    .switch{ display:flex; align-items:center; gap:8px; color:var(--muted); font-size:.95rem }

    button{
      appearance:none; border:none; cursor:pointer;
      background: linear-gradient(180deg, var(--primary), var(--primary-2));
      color:#fff; font-weight:700; letter-spacing:.2px;
      padding: 12px 18px; border-radius:12px; box-shadow: 0 10px 30px rgba(79,70,229,.35);
      transition: .18s ease;
    }
    button:hover{ transform: translateY(-1px); }
    button:disabled{ opacity:.55; cursor:not-allowed; transform:none; box-shadow:none; }

    .meta{
      display:grid; gap:10px; margin-top: 10px;
      font-size:.95rem; color:var(--muted);
    }
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      background: rgba(255,255,255,.06);
      padding:6px 10px; border-radius:999px; border:1px solid rgba(255,255,255,.07);
      color:#e8e9ee;
    }
    .status{ margin-top: 10px; font-size:.96rem; }
    .ok{ color: var(--ok); }
    .warn{ color: var(--warn); }
    .err{ color: var(--err); }

    ul.req{ margin:8px 0 0 18px; }
    .small{ font-size:.92rem; color:var(--muted); }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo" aria-hidden="true"></div>
      <div>
        <h1>Batch Trip Duration — CSV Upload</h1>
        <p class="subtitle">Upload your dataset and get a CSV back with an extra <span class="code">predicted_duration</span> column.</p>
      </div>
    </header>

    <div class="grid">
      <!-- Left: Uploader -->
      <div class="card">
        <form id="upload-form" action="/predict_csv" method="post" enctype="multipart/form-data">
          <label class="label" for="file">Your CSV file</label>

          <!-- Drop area -->
          <div id="drop" class="drop" tabindex="0">
            <div>
              <strong>Drag & drop</strong> your file here<br/>
              <span class="hint">or click to choose a file</span>
            </div>
            <input id="file" name="file" type="file" accept=".csv,text/csv" style="display:none" required />
          </div>

          <div class="meta" id="file-meta" style="display:none">
            <div class="pill" id="meta-name">name.csv</div>
            <div class="pill" id="meta-size">0 KB</div>
            <div class="pill">Required columns:
              <span class="code">passenger_count, trip_distance, fare_amount, total_amount, PULocationID, DOLocationID</span>
            </div>
          </div>

          <div class="status" id="status"></div>

          <div class="controls">
            <label class="switch">
              <input type="checkbox" id="return_only_predictions" name="return_only_predictions" value="true"/>
              Only predictions column
            </label>
            <button id="submit-btn" type="submit" disabled>Run Batch Prediction</button>
          </div>
        </form>
      </div>

      <!-- Right: Help / Notes -->
      <aside class="card">
        <h3 style="margin-top:0">Format requirements</h3>
        <p class="small">Your CSV must include these headers (order doesn’t matter):</p>
        <ul class="req">
          <li><code class="code">passenger_count</code></li>
          <li><code class="code">trip_distance</code></li>
          <li><code class="code">fare_amount</code></li>
          <li><code class="code">total_amount</code></li>
          <li><code class="code">PULocationID</code></li>
          <li><code class="code">DOLocationID</code></li>
        </ul>
        <p class="small" style="margin-top:12px">
          Tip: If your file is large, the server processes it in chunks to keep memory low.
        </p>
        <h4 style="margin-bottom:6px">cURL example</h4>
        <pre class="code" style="white-space:pre-wrap; margin:0">curl -X POST \
  -F "file=@/path/to/your.csv" \
  http://localhost:9696/predict_csv -o predictions.csv</pre>
      </aside>
    </div>
  </div>

  <script>
    // ---- Config
    const REQUIRED = ["passenger_count","trip_distance","fare_amount","total_amount","PULocationID","DOLocationID"]
      .map(h => h.toLowerCase());

    // ---- Elements
    const drop = document.getElementById('drop');
    const fileInput = document.getElementById('file');
    const meta = document.getElementById('file-meta');
    const metaName = document.getElementById('meta-name');
    const metaSize = document.getElementById('meta-size');
    const statusEl = document.getElementById('status');
    const submitBtn = document.getElementById('submit-btn');
    const form = document.getElementById('upload-form');

    // ---- Helpers
    function humanSize(bytes){
      const units=['B','KB','MB','GB']; let i=0, n=bytes;
      while(n>=1024 && i<units.length-1){ n/=1024; i++; }
      return `${n.toFixed(n<10 && i>0?1:0)} ${units[i]}`;
    }
    function showStatus(text, type){
      statusEl.textContent = text;
      statusEl.className = 'status ' + (type||'');
    }
    function enableSubmit(ok){ submitBtn.disabled = !ok; }

    function pickFile(){ fileInput.click(); }

    function handleFiles(files){
      if(!files || !files.length) return;
      const f = files[0];
      fileInput.files = files;
      meta.style.display = 'grid';
      metaName.textContent = f.name;
      metaSize.textContent = humanSize(f.size);

      // Validate headers by reading the first line
      const reader = new FileReader();
      reader.onload = () => {
        try{
          const text = reader.result;
          const firstLine = (text.split(/\r?\n/)[0] || '').trim();
          const headers = firstLine.split(',').map(h => h.trim().replace(/^"|"$/g,'').toLowerCase());
          const missing = REQUIRED.filter(r => !headers.includes(r));
          if(missing.length){
            showStatus(`Missing required columns: ${missing.join(', ')}`, 'err');
            enableSubmit(false);
          }else{
            showStatus('File looks good. You can run the batch prediction.', 'ok');
            enableSubmit(true);
          }
        }catch(e){
          showStatus('Could not read CSV header. You can still try to upload.', 'warn');
          enableSubmit(true);
        }
      };
      // Read only the first ~32KB to get the header quickly
      const blob = f.slice(0, 32768);
      reader.readAsText(blob);
    }

    // ---- Drag & Drop wiring
    ['dragenter','dragover'].forEach(evt =>
      drop.addEventListener(evt, e => { e.preventDefault(); e.stopPropagation(); drop.classList.add('dragover'); })
    );
    ['dragleave','drop'].forEach(evt =>
      drop.addEventListener(evt, e => { e.preventDefault(); e.stopPropagation(); drop.classList.remove('dragover'); })
    );
    drop.addEventListener('click', pickFile);
    drop.addEventListener('drop', e => handleFiles(e.dataTransfer.files));
    fileInput.addEventListener('change', e => handleFiles(e.target.files));

    // ---- Submit UX
    form.addEventListener('submit', () => {
      enableSubmit(false);
      submitBtn.textContent = 'Processing…';
    });
  </script>
</body>
</html>
